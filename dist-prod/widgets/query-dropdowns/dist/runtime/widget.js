System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-core/react"],(function(e,t){var n={},a={},o={},r={};return{setters:[function(e){n.React=e.React,n.appActions=e.appActions},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.AdvancedSelect=e.AdvancedSelect,o.Button=e.Button,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Label=e.Label,o.Radio=e.Radio},function(e){r.default=e.default,r.useEffect=e.useEffect,r.useState=e.useState}],execute:function(){e((()=>{var e={603:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(81),o=n.n(a),r=n(645),l=n.n(r)()(o());l.push([e.id,"#root{max-width:500px;padding:12px;margin:auto}h4{color:var(--dark);font-size:1.25em}.dropdown{min-width:100px;max-width:200px;width:90%}.render-container{height:100%;overflow:auto;overflow-y:auto;overflow-x:auto;padding:16px 16px 15% 16px}.wrapper{position:relative;display:flex;align-items:center;margin:1rem calc(16px / 1);height:calc(16px + 1.6rem);max-width:200px;min-width:32px}.input-wrapper{width:calc(100% + 16px);position:absolute;height:16px}.control-wrapper{width:90%;position:absolute;height:16px}.input{position:absolute;width:90%;pointer-events:none;appearance:none;height:100%;opacity:0;z-index:3;padding:0}.input::-ms-track{appearance:none;background:transparent;border:transparent}.input::-moz-range-track{appearance:none;background:transparent;border:transparent}.input:focus::-webkit-slider-runnable-track{appearance:none;background:transparent;border:transparent}.input::-ms-thumb{appearance:none;pointer-events:all;width:16px;height:16px;border-radius:0px;border:0 none;cursor:grab}.input::-ms-thumb:active{cursor:grabbing}.input::-moz-range-thumb{appearance:none;pointer-events:all;width:16px;height:16px;border-radius:0px;border:0 none;cursor:grab}.input::-moz-range-thumb:active{cursor:grabbing}.input::-webkit-slider-thumb{appearance:none;pointer-events:all;width:16px;height:16px;border-radius:0px;border:0 none;cursor:grab}.input::-webkit-slider-thumb:active{cursor:grabbing}.control-label{position:absolute;top:100%;transform:translateX(-50%);white-space:nowrap}.rail{position:absolute;width:100%;top:50%;transform:translateY(-50%);height:6px;border-radius:3px;background:var(--secondary)}.inner-rail{position:absolute;height:100%;background:darkgray;opacity:0.5}.control{width:16px;height:16px;border-radius:50%;position:absolute;background:var(--white);border-style:solid;border-color:var(--primary);top:50%;margin-left:calc(16px / -2);transform:translate3d(0, -50%, 0);z-index:2}\n",""]);const c=l},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(a)for(var c=0;c<this.length;c++){var i=this[c][0];null!=i&&(l[i]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);a&&l[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},379:e=>{"use strict";var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},l=[],c=0;c<e.length;c++){var i=e[c],s=a.base?i[0]+a.base:i[0],u=r[s]||0,d="".concat(s," ").concat(u);r[s]=u+1;var p=n(d),m={css:i[1],media:i[2],sourceMap:i[3],supports:i[4],layer:i[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var f=o(m,a);a.byIndex=c,t.splice(c,0,{identifier:d,updater:f,references:1})}l.push(d)}return l}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=a(e=e||[],o=o||{});return function(e){e=e||[];for(var l=0;l<r.length;l++){var c=n(r[l]);t[c].references--}for(var i=a(e,o),s=0;s<r.length;s++){var u=n(r[s]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}r=i}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,o&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},826:e=>{"use strict";e.exports=a},891:e=>{"use strict";e.exports=n},315:e=>{"use strict";e.exports=r},726:e=>{"use strict";e.exports=o}},t={};function l(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="",l.nc=void 0;var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{__set_webpack_public_path__:()=>M,default:()=>C});var e=l(891),t=l(379),n=l.n(t),a=l(795),o=l.n(a),r=l(569),i=l.n(r),s=l(565),u=l.n(s),d=l(216),p=l.n(d),m=l(589),f=l.n(m),v=l(603),g={};g.styleTagTransform=f(),g.setAttributes=u(),g.insert=i().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=p(),n()(v.Z,g),v.Z&&v.Z.locals&&v.Z.locals;var h=l(826),b=l(726);function y({dataSource:t,variables:n,handleVarClick:a}){return t?n.map(((t,n)=>e.React.createElement(e.React.Fragment,null,e.React.createElement(b.DropdownItem,{key:n,value:t,onClick:()=>a(t)},t)))):null}function w({sourceVariables:t,handleVarClick:n}){if(!t)throw new Error("sourceVariables is null or undefined");const a=Object.entries(t).flatMap((([e,t])=>(null==t?void 0:t.map((t=>`${e}: ${t}`)))||[]));return e.React.createElement(e.React.Fragment,null,a.map(((t,a)=>e.React.createElement(b.DropdownItem,{key:a,value:t,onClick:()=>n(t)},t))))}function R({zones:t,handleZoneClick:n}){return t?t.map(((t,a)=>{var o,r;return e.React.createElement(e.React.Fragment,null,e.React.createElement(b.DropdownItem,{key:a,value:t.title,onClick:()=>n(t)},(null===(o=t.title)||void 0===o?void 0:o.split(" - ")[1])?null===(r=t.title)||void 0===r?void 0:r.split(" - ")[1]:t.title))})):null}var x=l(315);function E({selectedZones:e,polygons:t=[],handleZoneSubsetClick:n}){const[a,o]=(0,x.useState)(Date.now());return(0,x.useEffect)((()=>{o(Date.now())}),[t]),x.default.createElement(b.AdvancedSelect,{key:a,staticValues:t,selectedValues:e,placeholder:"please select",onChange:function(e){console.log(e),e?e.some((e=>"select_all"==e.value))?(console.log("selecting all"),n(t)):e.length&&n(e):n([])},isMultiple:!0,hideBottomTools:!1,hideSearchInput:!1,sortValuesByLabel:!1,customDropdownButtonContent:n=>0===e.length?"Select Zones":1===e.length?e[0].label:e.length===t.length-1?"All Zones Selected":`${e.length} Zones Selected`})}function S({dataSources:t,handleDataSourceClick:n}){return e.React.createElement(e.React.Fragment,null,Object.keys(t).map(((t,a)=>e.React.createElement(b.DropdownItem,{key:a,value:t,onClick:()=>n(t)},t))))}function D({min:e,max:t,value:n,step:a,onChange:o,theme:r}){const[l,c]=x.default.useState(n?n.min:e),[i,s]=x.default.useState(n?n.max:t);x.default.useEffect((()=>{n&&(c(n.min),s(n.max))}),[n]);const u=(l-e)/(t-e)*100,d=(i-e)/(t-e)*100,p=(e=>{const t=e.colors,n={};for(const[e,a]of Object.entries(t))n[`--${e}`]=a;return n})(r);return x.default.createElement("div",{className:"wrapper"},x.default.createElement("div",{className:"input-wrapper"},x.default.createElement("input",{className:"input",type:"range",value:l,min:e,max:t,step:a,onChange:e=>{e.preventDefault();const t=Math.min(+e.target.value,i-a);n||c(t),o({min:t,max:i})}}),x.default.createElement("input",{className:"input",type:"range",value:i,min:e,max:t,step:a,onChange:e=>{e.preventDefault();const t=Math.max(+e.target.value,l+a);n||s(t),o({min:l,max:t})}})),x.default.createElement("div",{className:"control-wrapper",style:p},x.default.createElement("div",{className:"control",style:{left:`${u}%`}}),x.default.createElement("div",{className:"control-label",style:{left:`${u}%`}},l),x.default.createElement("div",{className:"rail"},x.default.createElement("div",{className:"inner-rail",style:{left:`${u}%`,right:100-d+"%"}})),x.default.createElement("div",{className:"control",style:{left:`${d}%`}}),x.default.createElement("div",{className:"control-label",style:{left:`${d}%`}},i)))}var k=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function l(e){try{i(a.next(e))}catch(e){r(e)}}function c(e){try{i(a.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,c)}i((a=a.apply(e,t||[])).next())}))};function C(t){var n;console.log(t);const[a,o]=e.React.useState(null),[r,l]=e.React.useState({dataset:null,title:"",tables:[],polygons:[{label:"",value:"",objectid:0}]}),[c,i]=e.React.useState([]),[s,u]=e.React.useState(""),[d,p]=e.React.useState([]),[m,f]=e.React.useState(""),[v,g]=e.React.useState({source:"",variables:[]});console.log(v);const[x,C]=e.React.useState([]),[M,N]=e.React.useState(0),[j,A]=e.React.useState([2e3,2025]),[_,$]=e.React.useState({min:Math.min(...j),max:Math.max(...j)}),[I,V]=e.React.useState([]);e.React.useEffect((()=>{t.dispatch(e.appActions.widgetStatePropChange("widget_comms","dataTable",x))}),[x]);const T=e.React.useRef(c);e.React.useEffect((()=>{a&&r&&(T.current=c,console.log("zoneSubset changed",c),O(c.map((e=>e.value))))}),[c]),e.React.useEffect((()=>{let e,t;return console.log("click handler triggered"),function(n,a){k(this,void 0,void 0,(function*(){if(n&&a){const o=yield n.view.whenLayerView(a);e=e=>k(this,void 0,void 0,(function*(){const t={include:a};console.log(a),console.log(o.highlightOptions);const r=yield n.view.hitTest(e,t);if(console.log(r),r.results.length>0){const e=r.results[0].graphic;console.log(e.attributes),console.log(a.declaredClass),function(e){const t={label:e.name,value:e.zone_name,objectid:e.objectid};console.log(t),console.log(T.current),console.log(T.current.includes(t));const n=T.current.some((e=>e.label===t.label&&e.value===t.value&&e.objectid===t.objectid));if(console.log(n),n){const e=T.current.filter((e=>!(e.label===t.label&&e.value===t.value&&e.objectid===t.objectid)));Z(e)}else Z([...T.current,t])}(e.attributes)}})),t=n.view.on("click",e),console.log(t)}}))}(a,r.dataset),console.log(t),()=>{e&&t.remove()}}),[a,r]),e.React.useEffect((()=>{if(r.dataset&&v.source){const e=r.tables.filter((e=>e.title.includes(v.source.split(" ")[1])))[0],t=m?r.tables.filter((e=>e.title.includes(m.split(":")[0].split(" ")[1])))[0]:void 0;function n(e){return k(this,void 0,void 0,(function*(){try{if("feature"===e.type){yield e.load(),console.log(e);const t=e.createQuery();t.returnDistinctValues=!0,t.outFields=["stdtime"];const n=(yield e.queryFeatures(t)).features.map((e=>{return t=e.attributes.stdtime,new Date(t).getUTCFullYear();var t}));return console.log("Unique values in 'variable' field:",n),n}}catch(e){console.error("Error loading table:",e)}}))}(()=>{k(this,void 0,void 0,(function*(){const a=yield n(e),o=t&&1===M?yield n(t):void 0,r=o?a.filter((e=>o.includes(e))):a,l=Math.min(...r),c=Math.max(...r);if(A(r),!r.includes(_.min)||!r.includes(_.max)||_.min==Math.min(...j)||_.max==Math.max(...j)){const e=Object.assign(Object.assign({},_),{min:r.includes(_.min)&&_.min!=Math.min(...j)?_.min:l,max:r.includes(_.max)&&_.max!=Math.max(...j)?_.max:c});console.log(e),$(e)}}))})()}}),[r.dataset,v.source,m,M]),e.React.useEffect((()=>{if(r.dataset&&v.source&&s){console.log(c);const e=c.map((e=>`'${e.value}'`)).join(", ");if(0==M){const t=`zone_name IN (${e}) AND variable = '${s}' AND stdtime >= date '${_.min}-01-01' AND stdtime <= date '${_.max}-01-01'`;console.log("setting query"),V([t])}else if(1==M){const t=`zone_name IN (${e}) AND variable = '${s}' AND stdtime >= date '${_.min}-01-01' AND stdtime <= date '${_.max}-01-01'`,n=`zone_name IN (${e}) AND variable = '${m.split(": ")[1]}' AND stdtime >= date '${_.min}-01-01' AND stdtime <= date '${_.max}-01-01'`;V([t,n])}}}),[r,v,c,M,s,m,_]);const z=e.React.useRef(null),O=e=>k(this,void 0,void 0,(function*(){const t=yield a.view.whenLayerView(r.dataset);console.log(e),console.log(r.polygons);const n=r.polygons.filter((t=>e.includes(t.value)&&"select_all"!==t.value)).map((e=>e.objectid));console.log(z),console.log(n),console.log(c),z.current&&z.current.remove(),z.current=t.highlight(n)}));function Z(e){console.log(e),console.log([...e.filter((e=>"select_all"!==e.value))]),i([...e.filter((e=>"select_all"!==e.value))])}e.React.useEffect((()=>{v.source&&f("")}),[v.source,s]),e.React.useEffect((()=>{v.source&&t.config.DataSources&&(t.config.DataSources[v.source].variables.includes(s)||u(null))}),[v.source]);const P=(e,t,n)=>{console.log(n),N(n)},F=e.React.useRef(r.dataset);return e.React.useEffect((()=>{F.current=r.dataset}),[r.dataset]),e.React.createElement("div",{className:"render-container"},t.useMapWidgetIds&&1===t.useMapWidgetIds.length&&e.React.createElement(h.JimuMapViewComponent,{useMapWidgetId:null===(n=t.useMapWidgetIds)||void 0===n?void 0:n[0],onActiveViewChange:e=>{e&&e.view.map&&(e.view.highlightOptions={color:"#8af542",haloOpacity:.7,fillOpacity:.2},o(e))}}),e.React.createElement("h3",null,"Area of Interest"),e.React.createElement(b.Dropdown,{className:"dropdown"},e.React.createElement(b.DropdownButton,null,(null==r?void 0:r.dataset)?r.title:"Feature Layers"),e.React.createElement(b.DropdownMenu,null,e.React.createElement(R,{zones:null==a?void 0:a.view.map.layers.items,handleZoneClick:function(e){var t;if((null===(t=r.dataset)||void 0===t?void 0:t.title)===e.title)return void console.log("already selected");let n;console.log("querying zone tables");const o=e.createQuery();o.outFields=["name, zone_name, objectid"],o.returnGeometry=!1,e.queryFeatures(o).then((function(t){console.log(t),n=Array.isArray(t.features)?[{label:"Select All",value:"select_all",objectid:null},...t.features.map((e=>({label:e.attributes.name||"Unnamed Polygon",value:e.attributes.zone_name||"No Code",objectid:e.attributes.objectid||0})))]:[],r.dataset&&(r.dataset.visible=!1),l({dataset:e,title:e.title.split(" - ")[1],tables:a.view.map.tables.items.filter((t=>t.url===e.url)),polygons:n}),console.log(n),i(n.filter((e=>"select_all"!==e.value)))})),e.visible=!0,e.outFields=["*"]}}))),e.React.createElement("h4",null,"Zone Selection"),r.dataset?e.React.createElement(E,{polygons:r.polygons,selectedZones:c,handleZoneSubsetClick:Z}):e.React.createElement(b.Dropdown,{className:"dropdown"},e.React.createElement(b.DropdownButton,{disabled:!0},"Select Zone Dataset")),e.React.createElement("h3",null,"Primary Data Source"),e.React.createElement(b.Dropdown,{className:"dropdown"},e.React.createElement(b.DropdownButton,null,v.source?v.source:"Select Data Source"),e.React.createElement(b.DropdownMenu,null,e.React.createElement(S,{dataSources:t.config.DataSources,handleDataSourceClick:function(e){g({source:e,variables:Array.from(t.config.DataSources[e].variables)}),console.log(t.config.DataSources)}}))),e.React.createElement("h4",null,"Primary Variable"),e.React.createElement(b.Dropdown,{className:"dropdown"},e.React.createElement(b.DropdownButton,{disabled:!v.source},v.source&&s?s:"Please Select"),e.React.createElement(b.DropdownMenu,null,e.React.createElement(y,{dataSource:v.source,variables:v.variables,handleVarClick:function(e){console.log(e),e.replace(/\s+/g,"_"),console.log(t.config.AllowedCombinations),u(e),p(t.config.AllowedCombinations[e].asMutable())}}))),e.React.createElement("h4",null,"Secondary Variable "),e.React.createElement(b.Dropdown,{className:"dropdown"},e.React.createElement(b.DropdownButton,{disabled:1!=M||!v.source||!s},v.source&&m?m:"Please Select"),e.React.createElement(b.DropdownMenu,null,e.React.createElement(w,{sourceVariables:d,handleVarClick:function(e){console.log(e),f(e)}}))),e.React.createElement("h4",null,"Type of Plot"),e.React.createElement(b.Label,null,e.React.createElement(b.Radio,{name:"timeseries",checked:0===M,onChange:(e,t)=>{P(0,0,0)}}),"Time Series"),e.React.createElement("br",null),e.React.createElement(b.Label,null,e.React.createElement(b.Radio,{name:"scatterplot",checked:1===M,onChange:(e,t)=>{P(0,0,1)}}),"Scatter Plot"),e.React.createElement("h4",null,"Time Range"),j&&e.React.createElement("div",null,e.React.createElement(D,{min:Math.min(...j),max:Math.max(...j),step:1,value:_,onChange:$,theme:t.theme})),e.React.createElement(b.Button,{onClick:function(){return k(this,void 0,void 0,(function*(){function e(e,t){return k(this,void 0,void 0,(function*(){try{if("feature"===e.type){yield e.load(),console.log(e.fields.map((e=>e.name)));const n=e.createQuery();return n.returnDistinctValues=!0,n.where=t,console.log(t),(yield e.queryFeatures(n)).features.map((e=>e.attributes))}}catch(e){console.error("Error loading table:",e)}}))}if(0===M)if(r.dataset&&v.source&&s){const t=r.tables.filter((e=>e.title.includes(v.source.split(" ")[1])))[0];if(t){const n=yield e(t,I[0]);C([n])}else console.error("No matching table found.")}else console.error("Required conditions are not met.");if(1===M)if(r.dataset&&v.source&&s&&m){const t=r.tables.filter((e=>e.title.includes(v.source.split(" ")[1])))[0];console.log(m.split(":")[0]);const n=r.tables.filter((e=>e.title.includes(m.split(":")[0].split(" ")[1])))[0];if(t&&n){const a=yield e(t,I[0]),o=yield e(n,I[1]);C([a,o])}else console.error("Error fetching table(s).")}else console.error("Required conditions are not met.")}))},disabled:!Object.keys(I).length,size:"default"},"Generate Table"))}function M(e){l.p=e}})(),c})())}}}));